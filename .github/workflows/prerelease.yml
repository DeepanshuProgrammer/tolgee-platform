name: Prerelease

on:
  push:
    branches:
      - 'testsr'

jobs:
  main:
    concurrency:
      group: prerelease
      cancel-in-progress: true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-java@v1
        with:
          java-version: 11

      - name: Setup node
        uses: actions/setup-node@v1
        with:
          node-version: '12.x'


      - name: Install node modules
        run: npm ci

      - name: Set git globals
        run: |
          git config --local user.email "machine@tolgee.io"
          git config --local user.name "Tolgee Machine"

      - name: Increase version
        id: version
        run: echo ::set-output name=VERSION::$(npm run release)

      - name: Set version property
        id: version
        run: echo ::set-output name=VERSION::$(git describe --exact-match --tags $(git log -n1 --pretty='%h'))
